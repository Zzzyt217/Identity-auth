# 步骤 1：拿到链的访问信息和证书（细化版）

**前提**：虚拟机里 FISCO 链已搭建并验证通过；本机用 IDEA 跑应用，连接虚拟机里的链。

**需要记录的信息**：见文末「步骤 1 记录表」，请逐项填写并保存。

---

## 第一部分：在虚拟机里执行（按顺序做）

### 步骤 1.1 进入节点根目录

**操作**：打开虚拟机终端，执行（若你的建链目录不是 `~/fisco`，请改成实际路径）：

```bash
cd ~/fisco/nodes/127.0.0.1
pwd
```

**需要记录**：把 `pwd` 输出记下来，即「节点根目录」的完整路径。  
→ 填到记录表 **【A】节点根目录**。

---

### 步骤 1.2 确认节点与 sdk 目录存在

**操作**：

```bash
ls -la
```

**检查**：列表中应能看到 `node0`、`node1` 等目录；若有 `sdk` 目录，证书一般在这里。

**需要记录**：是否有 `sdk` 目录？若有，记「有 sdk」；若没有，记「无 sdk，用 node0/conf」。  
→ 用于后面找证书路径。

---

### 步骤 1.3 查看 node0 的 Channel 端口

**操作**：

```bash
grep channel_listen_port node0/config.ini
```

**示例输出**：`channel_listen_port=20200`

**需要记录**：等号后面的数字（如 `20200`）。  
→ 填到记录表 **【B】Channel 端口（node0）**。

---

### 步骤 1.4 查看 node0 的 RPC 端口（可选）

**操作**：

```bash
grep rpc_listen_port node0/config.ini
```

若无输出，再试：

```bash
cat node0/config.ini | grep -i rpc
```

**需要记录**：若找到 `rpc_listen_port=数字`，记下该数字（如 `8545`）。  
→ 填到记录表 **【C】RPC 端口（可选）**。若未找到可留空。

---

### 步骤 1.5 确定证书所在目录并列出文件

**操作一**：先看 sdk 目录（若 1.2 有 sdk）：

```bash
ls -la sdk/
```

**操作二**：若没有 sdk 或 sdk 里没有 .crt/.key，再看 node0：

```bash
ls -la node0/conf/
```

**需要记录**：  
- 证书实际所在目录：`sdk` 还是 `node0/conf`（或其它，请写完整路径）。  
→ 填到记录表 **【D】证书所在目录（虚拟机内完整路径）**。  
- 该目录下这三个文件的**确切文件名**：  
  - CA 证书：一般是 `ca.crt`  
  - SDK 证书：常见 `sdk.crt` 或 `node.crt`  
  - SDK 私钥：常见 `sdk.key` 或 `node.key`  
→ 填到记录表 **【E】证书文件名（ca / sdk 证 / sdk 钥）**。

---

### 步骤 1.6 记下三个证书的完整路径（供拷贝用）

**操作**：根据 1.5 的结果，在终端里打出三个文件的完整路径并确认存在。  
若证书在 `sdk` 且 `pwd` 为 `/root/fisco/nodes/127.0.0.1`，则执行：

```bash
echo $(pwd)/sdk/ca.crt
echo $(pwd)/sdk/sdk.crt
echo $(pwd)/sdk/sdk.key
ls -la sdk/ca.crt sdk/sdk.crt sdk/sdk.key
```

若你的证书在 `node0/conf` 或文件名不同，请把上面路径里的 `sdk` 或文件名改成实际名称。

**需要记录**：把三条完整路径抄下来（例如 `/root/fisco/nodes/127.0.0.1/sdk/ca.crt` 等）。  
→ 填到记录表 **【F】证书完整路径（虚拟机）**。

---

### 步骤 1.7 获取虚拟机 IP（本机连链用）

**操作**：

```bash
hostname -I | awk '{print $1}'
```

若无输出，再用：

```bash
ip addr show | grep "inet " | grep -v 127.0.0.1
```

取其中类似 `192.168.x.x` 或 `10.x.x.x` 的地址。

**需要记录**：记下该 IP（仅一个，本机能 ping 通的那个）。  
→ 填到记录表 **【G】虚拟机 IP**。

---

### 步骤 1.8（可选）本机测试能否连上虚拟机端口

**操作**：在本机 Windows PowerShell 或 CMD 执行（把 `192.168.x.x` 换成你在 1.7 记的 IP）：

```powershell
Test-NetConnection -ComputerName 192.168.x.x -Port 20200
```

若 `TcpTestSucceeded : True`，说明本机可以连上虚拟机的 Channel 端口。  
若失败，检查虚拟机防火墙是否放行 20200（及 20201 等），或改用端口转发方式。

**需要记录**：能否连通（是/否）。若否，后续需处理防火墙或端口转发。

---

## 第二部分：在本机（Windows）操作

### 步骤 2.1 在项目里创建证书目录

**操作**：在本机资源管理器中创建文件夹（若已存在可跳过）：

```
F:\Identity_authentication（毕设）\auth-service\src\main\resources\conf
```

或在 IDEA 里：在 `auth-service/src/main/resources` 下右键 → New → Directory → 输入 `conf`。

**需要记录**：本机证书目录完整路径。  
→ 填到记录表 **【H】本机证书目录（项目内）**。

---

### 步骤 2.2 从虚拟机拷贝三个证书到本机 conf 目录

任选一种方式，把虚拟机里 **ca.crt、sdk.crt、sdk.key**（或你在 1.5 记下的实际文件名）拷到 2.1 的 `conf` 目录。

**方式 A：共享文件夹**

1. 虚拟机：把 `sdk`（或 `node0/conf`）里的 `ca.crt`、`sdk.crt`、`sdk.key` 复制到共享文件夹。  
2. 本机：从共享文件夹把这三个文件复制到 `auth-service\src\main\resources\conf\`。

**方式 B：SCP（本机 PowerShell，替换为你的虚拟机用户、IP 和路径）**

```powershell
$vmUser = "root"
$vmIp = "192.168.x.x"
$vmSdk = "/root/fisco/nodes/127.0.0.1/sdk"
$localConf = "F:\Identity_authentication（毕设）\auth-service\src\main\resources\conf"

scp ${vmUser}@${vmIp}:${vmSdk}/ca.crt $localConf
scp ${vmUser}@${vmIp}:${vmSdk}/sdk.crt $localConf
scp ${vmUser}@${vmIp}:${vmSdk}/sdk.key $localConf
```

**方式 C：虚拟机打包后拷贝**

虚拟机执行（路径和文件名按你实际改）：

```bash
cd ~/fisco/nodes/127.0.0.1/sdk
tar czvf sdk-certs.tar.gz ca.crt sdk.crt sdk.key
```

把 `sdk-certs.tar.gz` 通过共享文件夹或 U 盘拷到本机，解压到 `auth-service\src\main\resources\conf\`，确保解压后该目录下有 `ca.crt`、`sdk.crt`、`sdk.key`。

**需要记录**：拷贝完成后，确认三个文件都在 `conf` 下且名称正确。  
→ 在记录表 **【I】证书已拷到本机** 填「是」。

---

### 步骤 2.3 确认本机 conf 目录内容

**操作**：在本机打开 `auth-service\src\main\resources\conf\`，确认存在且仅需这三个（名称与虚拟机一致）：

- `ca.crt`
- `sdk.crt`（或你记下的 sdk 证书名）
- `sdk.key`（或你记下的 sdk 私钥名）

**需要记录**：列出三个文件名，与记录表 **【E】** 一致。

---

## 第三部分：步骤 1 记录表（请逐项填写并保存）

以下为步骤 1 全部需要记录的信息，后续接入 Java SDK 时直接使用。

| 序号 | 项目 | 你的值（请填写） |
|------|------|------------------|
| **A** | 节点根目录（/root/fisco/nodes/127.0.0.1） | |
| **B** | Channel 端口（node0，如 20200） | |
| **C** | RPC 端口（可选，如 8545） | |
| **D** | 证书所在目录（虚拟机完整路径，如 …/sdk 或 …/node0/conf） | |
| **E** | 证书文件名：ca / sdk 证 / sdk 钥（如 ca.crt、sdk.crt、sdk.key） | |
| **F** | 三个证书的完整路径（虚拟机，便于 SCP 或文档） | ca: _____________  sdk.crt: _____________  sdk.key: _____________ |
| **G** | 虚拟机 IP（本机连链用，如 192.168.1.100） | |
| **H** | 本机证书目录（项目内，如 …/auth-service/src/main/resources/conf） | |
| **I** | 证书已拷到本机 conf（是/否） | |
| **J** | groupId（与 console 一致，一般为 1） | 1 |

---

## 完成后自检

- [ ] 记录表 A～J 已全部填写（C、F 可选）。  
- [ ] 本机 `conf` 目录下存在且仅使用 ca.crt、sdk.crt、sdk.key（或你在 E 中填写的名称）。  
- [ ] 本机可 ping 通虚拟机 IP，且（若已做 1.8）Channel 端口连通。

完成以上即**步骤 1 结束**，可进行步骤 2（在 auth-service 中引入 FISCO Java SDK 与配置）。
